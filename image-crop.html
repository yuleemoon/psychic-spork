<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>图片裁剪工具 - 在线自定义裁剪</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css">
    <script src="https://cdn.jsdelivr.net/npm/cropperjs@1.6.1/dist/cropper.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cropperjs@1.6.1/dist/cropper.min.css">
    <style>
        @layer utilities {
            .gradient-bg {
                background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            }
            .drop-area {
                border: 2px dashed #cbd5e1;
                transition: all 0.3s ease;
            }
            .drop-area.active {
                border-color: #3b82f6;
                background-color: #eff6ff;
            }
        }
        .cropper-container {
            max-height: 500px;
        }
    </style>
</head>
<body class="bg-slate-50 min-h-screen font-sans">
    <!-- 导航栏 -->
    <header class="gradient-bg text-white py-4 shadow-md">
        <div class="container mx-auto px-4 flex justify-between items-center">
            <div class="flex items-center gap-2">
                <i class="fa fa-crop text-xl"></i>
                <h1 class="text-xl font-bold">图片裁剪工具</h1>
            </div>
            <a href="index.html" class="bg-white/20 hover:bg-white/30 px-4 py-2 rounded-lg transition-colors">
                返回工具列表
            </a>
        </div>
    </header>

    <!-- 主要内容 -->
    <main class="container mx-auto px-4 py-8 max-w-5xl">
        <div class="bg-white rounded-xl shadow-md p-6 mb-6">
            <h2 class="text-2xl font-bold mb-4 text-slate-800">图片裁剪</h2>
            <p class="text-slate-600 mb-6">自定义尺寸裁剪图片，支持固定比例、自由裁剪，适配各种场景</p>
            
            <!-- 上传区域 -->
            <div id="dropArea" class="drop-area rounded-lg p-8 text-center mb-6">
                <i class="fa fa-cloud-upload text-4xl text-slate-400 mb-3"></i>
                <p class="text-slate-600 mb-2">点击或拖拽图片到此处上传</p>
                <p class="text-sm text-slate-400">支持JPG、PNG、WebP等格式，最大支持10MB</p>
                <input type="file" id="fileInput" accept="image/*" class="hidden">
                <button onclick="document.getElementById('fileInput').click()" class="mt-4 bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                    选择图片
                </button>
            </div>

            <!-- 裁剪区域 -->
            <div id="cropArea" class="hidden grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
                <!-- 左侧裁剪预览 -->
                <div class="lg:col-span-2">
                    <div class="relative border border-slate-200 rounded-lg overflow-hidden bg-slate-50">
                        <img id="cropImage" src="" alt="裁剪图片" class="w-full">
                    </div>
                </div>
                
                <!-- 右侧设置面板 -->
                <div class="space-y-6">
                    <div>
                        <h3 class="font-bold mb-3 text-slate-700">裁剪设置</h3>
                        
                        <!-- 比例选择 -->
                        <div class="mb-4">
                            <label class="block text-sm text-slate-600 mb-1">裁剪比例</label>
                            <select id="aspectRatio" class="w-full border border-slate-300 rounded-lg p-2 mb-2">
                                <option value="0">自由裁剪</option>
                                <option value="1">1:1 (正方形)</option>
                                <option value="16/9">16:9 (宽屏)</option>
                                <option value="4/3">4:3 (标准)</option>
                                <option value="3/2">3:2 (照片)</option>
                                <option value="9/16">9:16 (竖屏)</option>
                            </select>
                        </div>
                        
                        <!-- 自定义尺寸 -->
                        <div class="grid grid-cols-2 gap-2 mb-4">
                            <div>
                                <label class="block text-sm text-slate-600 mb-1">宽度 (px)</label>
                                <input type="number" id="customWidth" class="w-full border border-slate-300 rounded-lg p-2" placeholder="自动">
                            </div>
                            <div>
                                <label class="block text-sm text-slate-600 mb-1">高度 (px)</label>
                                <input type="number" id="customHeight" class="w-full border border-slate-300 rounded-lg p-2" placeholder="自动">
                            </div>
                        </div>
                        
                        <!-- 尺寸预览 -->
                        <div class="bg-slate-50 p-3 rounded-lg text-sm text-slate-600 mb-4">
                            <p>裁剪区域尺寸: <span id="cropSize">0 × 0</span> px</p>
                            <p>原始图片尺寸: <span id="originalSize">0 × 0</span> px</p>
                        </div>
                    </div>
                    
                    <div>
                        <h3 class="font-bold mb-3 text-slate-700">输出设置</h3>
                        <div class="mb-4">
                            <label class="block text-sm text-slate-600 mb-1">输出格式</label>
                            <select id="outputFormat" class="w-full border border-slate-300 rounded-lg p-2">
                                <option value="png">PNG (无损)</option>
                                <option value="jpeg">JPEG (压缩)</option>
                                <option value="webp">WebP (现代格式)</option>
                            </select>
                        </div>
                        <div class="mb-4">
                            <label class="block text-sm text-slate-600 mb-1">图片质量</label>
                            <input type="range" id="outputQuality" min="0" max="100" value="90" class="w-full">
                            <div class="flex justify-between text-xs text-slate-500 mt-1">
                                <span>低</span>
                                <span id="qualityValue">90%</span>
                                <span>高</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex gap-3">
                        <button id="cropBtn" class="flex-1 bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 transition-colors">
                            裁剪图片
                        </button>
                        <button id="resetBtn" class="flex-1 bg-slate-600 text-white px-6 py-2 rounded-lg hover:bg-slate-700 transition-colors">
                            重置
                        </button>
                    </div>
                </div>
            </div>

            <!-- 结果区域 -->
            <div id="resultArea" class="hidden mb-6">
                <h3 class="font-bold mb-3 text-slate-700">裁剪结果</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="border border-slate-200 rounded-lg p-3 bg-slate-50">
                        <h4 class="font-medium mb-2 text-slate-700">裁剪后的图片</h4>
                        <div class="relative aspect-video overflow-hidden rounded mb-3">
                            <img id="resultImage" src="" class="w-full h-full object-contain">
                        </div>
                        <div class="text-sm text-slate-600 mb-3">
                            <p id="resultSize">尺寸: 0 × 0 px</p>
                        </div>
                        <button id="downloadBtn" class="w-full bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition-colors">
                            <i class="fa fa-download mr-2"></i>下载图片
                        </button>
                    </div>
                    <div>
                        <h4 class="font-medium mb-2 text-slate-700">操作记录</h4>
                        <div id="logContainer" class="border border-slate-200 rounded-lg p-3 bg-slate-50 h-full text-sm text-slate-600 font-mono">
                            等待裁剪完成...
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- 页脚 -->
    <footer class="bg-slate-800 text-white py-4 text-center text-sm">
        <p>© 2025 在线工具集 - 所有操作均在本地完成，不会上传您的图片</p>
    </footer>

    <script>
        const dropArea = document.getElementById('dropArea');
        const fileInput = document.getElementById('fileInput');
        const cropArea = document.getElementById('cropArea');
        const cropImage = document.getElementById('cropImage');
        const resultArea = document.getElementById('resultArea');
        const resultImage = document.getElementById('resultImage');
        const aspectRatioSelect = document.getElementById('aspectRatio');
        const customWidth = document.getElementById('customWidth');
        const customHeight = document.getElementById('customHeight');
        const cropSize = document.getElementById('cropSize');
        const originalSize = document.getElementById('originalSize');
        const outputFormat = document.getElementById('outputFormat');
        const outputQuality = document.getElementById('outputQuality');
        const qualityValue = document.getElementById('qualityValue');
        const cropBtn = document.getElementById('cropBtn');
        const resetBtn = document.getElementById('resetBtn');
        const downloadBtn = document.getElementById('downloadBtn');
        const logContainer = document.getElementById('logContainer');
        const resultSize = document.getElementById('resultSize');
        
        let cropper = null;
        let originalFile = null;
        let croppedBlob = null;

        // 更新质量显示
        outputQuality.addEventListener('input', () => {
            qualityValue.textContent = `${outputQuality.value}%`;
        });

        // 拖拽功能
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            dropArea.addEventListener(eventName, preventDefaults, false);
        });

        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }

        ['dragenter', 'dragover'].forEach(eventName => {
            dropArea.addEventListener(eventName, highlight, false);
        });

        ['dragleave', 'drop'].forEach(eventName => {
            dropArea.addEventListener(eventName, unhighlight, false);
        });

        function highlight() {
            dropArea.classList.add('active');
        }

        function unhighlight() {
            dropArea.classList.remove('active');
        }

        // 处理文件上传
        dropArea.addEventListener('drop', handleDrop, false);
        fileInput.addEventListener('change', handleFiles, false);

        function handleDrop(e) {
            const dt = e.dataTransfer;
            const droppedFiles = dt.files;
            handleFileList(droppedFiles);
        }

        function handleFiles() {
            handleFileList(this.files);
        }

        function handleFileList(fileList) {
            const file = fileList[0];
            if (file && file.type.startsWith('image/')) {
                originalFile = file;
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    cropImage.src = e.target.result;
                    cropArea.classList.remove('hidden');
                    resultArea.classList.add('hidden');
                    
                    // 初始化裁剪器
                    if (cropper) {
                        cropper.destroy();
                    }
                    
                    setTimeout(() => {
                        cropper = new Cropper(cropImage, {
                            aspectRatio: 0,
                            viewMode: 1,
                            dragMode: 'crop',
                            responsive: true,
                            autoCropArea: 0.8,
                            crop: function(e) {
                                cropSize.textContent = `${Math.round(e.detail.width)} × ${Math.round(e.detail.height)}`;
                            }
                        });
                        
                        // 获取原始尺寸
                        const image = cropper.getImageData();
                        originalSize.textContent = `${Math.round(image.naturalWidth)} × ${Math.round(image.naturalHeight)}`;
                        
                        logContainer.textContent = `已加载图片: ${file.name}\n原始尺寸: ${originalSize.textContent} px`;
                    }, 100);
                };
                
                reader.readAsDataURL(file);
            }
        }

        // 更改裁剪比例
        aspectRatioSelect.addEventListener('change', () => {
            if (cropper) {
                const ratio = aspectRatioSelect.value === '0' ? NaN : eval(aspectRatioSelect.value);
                cropper.setAspectRatio(ratio);
                logContainer.textContent += `\n设置裁剪比例: ${aspectRatioSelect.options[aspectRatioSelect.selectedIndex].text}`;
            }
        });

        // 自定义尺寸
        [customWidth, customHeight].forEach(input => {
            input.addEventListener('change', () => {
                if (cropper && customWidth.value && customHeight.value) {
                    const width = parseInt(customWidth.value);
                    const height = parseInt(customHeight.value);
                    const imageData = cropper.getImageData();
                    
                    // 计算缩放比例
                    const scaleX = width / imageData.width;
                    const scaleY = height / imageData.height;
                    
                    cropper.setCropBoxData({
                        width: width,
                        height: height
                    });
                    
                    logContainer.textContent += `\n设置自定义尺寸: ${width} × ${height} px`;
                }
            });
        });

        // 裁剪图片
        cropBtn.addEventListener('click', () => {
            if (!cropper) return;
            
            cropBtn.disabled = true;
            cropBtn.innerHTML = '<i class="fa fa-spinner fa-spin mr-2"></i>裁剪中...';
            
            const format = outputFormat.value;
            const quality = outputQuality.value / 100;
            
            // 获取裁剪后的画布
            const canvas = cropper.getCroppedCanvas({
                fillColor: '#ffffff',
                imageSmoothingEnabled: true,
                imageSmoothingQuality: 'high'
            });
            
            // 转换为Blob
            canvas.toBlob((blob) => {
                croppedBlob = blob;
                
                // 显示结果
                const url = URL.createObjectURL(blob);
                resultImage.src = url;
                resultSize.textContent = `尺寸: ${canvas.width} × ${canvas.height} px`;
                
                // 更新日志
                logContainer.textContent += `\n裁剪完成！\n输出格式: ${format.toUpperCase()}\n输出质量: ${outputQuality.value}%\n最终尺寸: ${canvas.width} × ${canvas.height} px`;
                
                cropArea.classList.add('hidden');
                resultArea.classList.remove('hidden');
                
                cropBtn.disabled = false;
                cropBtn.innerHTML = '裁剪图片';
            }, `image/${format}`, quality);
        });

        // 重置
        resetBtn.addEventListener('click', () => {
            if (cropper) {
                cropper.reset();
                customWidth.value = '';
                customHeight.value = '';
                aspectRatioSelect.value = '0';
                outputQuality.value = '90';
                qualityValue.textContent = '90%';
                outputFormat.value = 'png';
                logContainer.textContent += '\n已重置裁剪区域';
            }
        });

        // 下载图片
        downloadBtn.addEventListener('click', () => {
            if (!croppedBlob || !originalFile) return;
            
            const fileName = originalFile.name.replace(/\.\w+$/, '') + '_cropped.' + outputFormat.value;
            const url = URL.createObjectURL(croppedBlob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = fileName;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            logContainer.textContent += `\n已下载文件: ${fileName}`;
        });
    </script>
</body>
</html>